# Название проекта: Система мониторинга энергопотребления

Данный репозиторий содержит Flask-приложение для системы мониторинга энергопотребления.
Приложение асинхронно собирает данные с нескольких энергосчетчиков и сохраняет их в базе данных PostgreSQL.
Приложение предоставляет точки доступа для добавления счетчиков, получения текущего состояния, получения статистики и удаления счетчиков.
Также включена фоновая задача, которая периодически получает данные от энергосчетчиков и обновляет базу данных.

## Содержание

- [Начало работы](#начало-работы)
  - [Предварительные требования](#предварительные-требования)
  - [Установка](#установка)
- [Использование](#использование)
  - [Запуск приложения](#запуск-приложения)
  - [Точки доступа (Endpoints)](#точки-доступа-endpoints)
- [Фоновая задача](#фоновая-задача)


## Начало работы

### Предварительные требования

- Python 3.6+
- База данных PostgreSQL
- Flask
- Flask-SQLAlchemy
- Flask-Migrate
- aiohttp
Весь список в файле requirements.txt

### Установка

1. Клонируйте репозиторий:

  - git clone git@github.com:ilinikem/flask_api_counters.git
  - cd flask_api_counters

2. Создайте виртуальное окружение
  - python -m venv venv
  - source /venv/bin/activate
  - pip install -r requirements.txt

3. Настройте базу данных PostgreSQL и сконфигурируйте файл config.py с соответствующим URI базы данных.


## Использование

### Запуск приложения
Для запуска Flask-приложения выполните следующую команду в терминале:
python app.py

После запуска, вы можете открыть приложение веб-браузере или воспользоваться инструментами, такими как curl или Postman.

### Точки доступа (Endpoints)
- **POST /add_counter:** Добавьте новый энергосчетчик. Если счетчик не будет зарегистрирован данные не будут записаны в БД.

- **GET /get_current_state:** Получите текущее состояние энергосчетчика.

- **GET /get_statistics/<int:counter_id>:** Получите статистику потребления для определенного счетчика в указанном временном диапазоне.

- **DELETE /delete_counter/<int:counter_id>:** Удалите энергосчетчик и связанные данные.

### Фоновая задача
Приложение включает фоновую задачу, которая асинхронно получает данные от энергосчетчиков и обновляет базу данных.
Задача запускается периодически с настраиваемым интервалом опроса.

Для этого создан скрипт simulated_counters.py, который создает счетчики на локальной машине(127.0.0.1:9001 и т.д)
и каждый последующий порт 9002, 9003 имеет свои данные которые могу быть считаны. Сами данные меняются в процессе работы скрипта.
